(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{453:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h2",{attrs:{id:"_2-1-基本介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-基本介绍"}},[t._v("#")]),t._v(" 2.1 基本介绍")]),t._v(" "),a("p",[a("code",[t._v("Nginx")]),t._v("是一个高性能的HTTP和反向代理web服务器。")]),t._v(" "),a("h3",{attrs:{id:"_2-1-1-nginx的优点"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-nginx的优点"}},[t._v("#")]),t._v(" 2.1.1 Nginx的优点：")]),t._v(" "),a("ol",[a("li",[t._v("高并发、高性能")]),t._v(" "),a("li",[t._v("可扩展性好")]),t._v(" "),a("li",[t._v("高可靠性")]),t._v(" "),a("li",[t._v("热部署")]),t._v(" "),a("li",[t._v("BSD许可证书")])]),t._v(" "),a("h3",{attrs:{id:"_2-1-2-nginx的组成"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-nginx的组成"}},[t._v("#")]),t._v(" 2.1.2 Nginx的组成：")]),t._v(" "),a("ol",[a("li",[t._v("二进制可执行文件")]),t._v(" "),a("li",[a("code",[t._v("Nginx.conf")]),t._v("配置文件")]),t._v(" "),a("li",[a("code",[t._v("access.log")]),t._v("访问日志")]),t._v(" "),a("li",[a("code",[t._v("error.log")]),t._v("错误日志")])]),t._v(" "),a("h3",{attrs:{id:"_2-1-3-的主要发行版本"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-的主要发行版本"}},[t._v("#")]),t._v(" 2.1.3 的主要发行版本")]),t._v(" "),a("ol",[a("li",[a("code",[t._v("Tengine")]),t._v("是阿里巴巴基于"),a("code",[t._v("Nginx")]),t._v("开发的第三方模块，但与"),a("code",[t._v("Nginx")]),t._v("更新不同步。")]),t._v(" "),a("li",[a("code",[t._v("OpenResty")]),t._v("是基于"),a("code",[t._v("Nginx")]),t._v("与"),a("code",[t._v("Lua")]),t._v("的高性能 Web 平台")])]),t._v(" "),a("h3",{attrs:{id:"_2-1-4-nginx配置语法"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-nginx配置语法"}},[t._v("#")]),t._v(" 2.1.4 Nginx配置语法")]),t._v(" "),a("ol",[a("li",[t._v("配置文件由指令块、指令组成。")]),t._v(" "),a("li",[t._v("指令块由大括号组成，里面的内容是指令。")]),t._v(" "),a("li",[t._v("指令以分号结尾，指令与参数空格分隔。")]),t._v(" "),a("li",[a("code",[t._v("include")]),t._v("语句可以引入多个配置文件")]),t._v(" "),a("li",[a("code",[t._v("#")]),t._v("注释")]),t._v(" "),a("li",[a("code",[t._v("$")]),t._v("变量")]),t._v(" "),a("li",[t._v("部分指令支持正则")]),t._v(" "),a("li",[t._v("时间配置参数："),a("code",[t._v("ms")]),t._v("毫秒、"),a("code",[t._v("s")]),t._v("秒、"),a("code",[t._v("m")]),t._v("分钟、"),a("code",[t._v("h")]),t._v("小时、"),a("code",[t._v("d")]),t._v("天、"),a("code",[t._v("w")]),t._v("周、"),a("code",[t._v("M")]),t._v("月、"),a("code",[t._v("y")]),t._v("年、")]),t._v(" "),a("li",[t._v("空间配置参数："),a("code"),t._v("字节、"),a("code",[t._v("k")]),t._v("/"),a("code",[t._v("K")]),t._v("kb、"),a("code",[t._v("m")]),t._v("/"),a("code",[t._v("M")]),t._v("兆、"),a("code",[t._v("g")]),t._v("/"),a("code",[t._v("G")]),t._v("G")])]),t._v(" "),a("h3",{attrs:{id:"_2-1-5-nginx命令行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-5-nginx命令行"}},[t._v("#")]),t._v(" 2.1.5 Nginx命令行")]),t._v(" "),a("ul",[a("li",[a("code",[t._v("start nginx")]),t._v("运行nginx")]),t._v(" "),a("li",[a("code",[t._v("nginx")]),t._v("+"),a("code",[t._v("-?")]),t._v("帮助")]),t._v(" "),a("li",[a("code",[t._v("nginx")]),t._v("+"),a("code",[t._v("-c")]),t._v("使用指定的配置文件")]),t._v(" "),a("li",[a("code",[t._v("nginx")]),t._v("+"),a("code",[t._v("-g")]),t._v("指定配置命令")]),t._v(" "),a("li",[a("code",[t._v("nginx")]),t._v("+"),a("code",[t._v("-p")]),t._v("指定运行目录")]),t._v(" "),a("li",[a("code",[t._v("nginx")]),t._v("+"),a("code",[t._v("-t")]),t._v("、"),a("code",[t._v("-T")]),t._v("测试配置文件是否有错误")]),t._v(" "),a("li",[a("code",[t._v("nginx")]),t._v("+"),a("code",[t._v("-v")]),t._v("、"),a("code",[t._v("-V")]),t._v("打印Nginx的版本信息、编译信息等")]),t._v(" "),a("li",[a("code",[t._v("nginx")]),t._v("+"),a("code",[t._v("-s")]),t._v("+"),a("code",[t._v("stop")]),t._v("/"),a("code",[t._v("squti")]),t._v("/"),a("code",[t._v("reload")]),t._v("/"),a("code",[t._v("reopen")]),t._v(" 立即停止服务、优雅的停止服务、重载配置文件、重新开始记录日志文件")]),t._v(" "),a("li",[a("code",[t._v('tasklist /fi "imagename eq nginx.exe"')]),t._v("查看nginx进程")])]),t._v(" "),a("h3",{attrs:{id:"_2-1-6-安全协议"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-6-安全协议"}},[t._v("#")]),t._v(" 2.1.6 安全协议")]),t._v(" "),a("h4",{attrs:{id:"使用let-s-encrypt配置证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#使用let-s-encrypt配置证书"}},[t._v("#")]),t._v(" 使用"),a("code",[t._v("Let's Encrypt")]),t._v("配置证书")]),t._v(" "),a("p",[a("code",[t._v("yum install python2-certbot-nginx")]),t._v("安装配置工具"),a("br"),t._v(" "),a("code",[t._v("certbot --nginx --nginx-server-root=/usr/local/openresty/nginx/conf/ -d")]),t._v("+"),a("code",[t._v("www.jaqi.com")]),t._v(" 给指定域名生成证书，并放置/usr/local/openresty/nginx/conf/目录下")]),t._v(" "),a("h3",{attrs:{id:"goaccess工具-可视化实时查看access日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#goaccess工具-可视化实时查看access日志"}},[t._v("#")]),t._v(" GoAccess工具：可视化实时查看access日志")]),t._v(" "),a("h2",{attrs:{id:"_2-2-构架基础"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-构架基础"}},[t._v("#")]),t._v(" 2.2 构架基础")]),t._v(" "),a("h4",{attrs:{id:"_2-2-1-nginx的请求处理流程"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-nginx的请求处理流程"}},[t._v("#")]),t._v(" 2.2.1 Nginx的请求处理流程")]),t._v(" "),a("p",[a("img",{attrs:{src:"/jaqi.note/Nginx%E7%9A%84%E8%AF%B7%E6%B1%82%E5%A4%84%E7%90%86%E6%B5%81%E7%A8%8B.jpg",alt:"Nginx的请求处理流程"}})]),t._v(" "),a("h4",{attrs:{id:"_2-2-2-nginx的进程结构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-nginx的进程结构"}},[t._v("#")]),t._v(" 2.2.2 Nginx的进程结构")]),t._v(" "),a("ul",[a("li",[t._v("多进程Nginx结构")])]),t._v(" "),a("ol",[a("li",[a("code",[t._v("Master")]),t._v("进程= "),a("code",[t._v("CM")]),t._v("进程+"),a("code",[t._v("CL")]),t._v("进程+n个"),a("code",[t._v("worker")]),t._v("进程")]),t._v(" "),a("li",[t._v("进程之间通过共享内存通讯")]),t._v(" "),a("li",[t._v("每个"),a("code",[t._v("worker")]),t._v("进程独占一个CPU内核")]),t._v(" "),a("li",[t._v("一个线程同时处理多个连接，尽量减少切换进程。")])]),t._v(" "),a("h4",{attrs:{id:"_2-2-3-nginx进程管理-信号"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-nginx进程管理-信号"}},[t._v("#")]),t._v(" 2.2.3 Nginx进程管理-信号")]),t._v(" "),a("ol",[a("li",[t._v("信号种类")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("term")]),t._v("/"),a("code",[t._v("int")]),t._v("立刻停止"),a("br"),t._v(" "),a("code",[t._v("quit")]),t._v("优雅的停止"),a("br"),t._v("\n``hup"),a("code",[t._v("重载配置文件")]),t._v("usr1"),a("code",[t._v("重新打开日志文件")]),t._v("usr2"),a("code",[t._v("、")]),t._v("winch`通过命令行发送信号，针对热部署使用")])]),t._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Master信号")])]),t._v(" "),a("blockquote",[a("p",[t._v("监控worker进程"),a("br"),t._v("\n管理worker进程"),a("br"),t._v("\n接受信号"),a("code",[t._v("term")]),t._v("、"),a("code",[t._v("int")]),t._v("、"),a("code",[t._v("quit")]),t._v("、"),a("code",[t._v("hup")]),t._v("、"),a("code",[t._v("usr1")]),t._v("、"),a("code",[t._v("usr2")]),t._v("、    "),a("code",[t._v("winch")])])]),t._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Worker信号")])]),t._v(" "),a("blockquote",[a("p",[t._v("接受信号"),a("code",[t._v("term")]),t._v("、"),a("code",[t._v("int")]),t._v("、"),a("code",[t._v("quit")]),t._v("、"),a("code",[t._v("usr1")]),t._v("、"),a("code",[t._v("winch")])])]),t._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[t._v("命令行信号")])]),t._v(" "),a("blockquote",[a("p",[a("code",[t._v("hup")]),t._v("、"),a("code",[t._v("usr1")]),t._v("、"),a("code",[t._v("term")]),t._v("、"),a("code",[t._v("quit")])])]),t._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v("TIP")]),t._v(" "),a("ol",[a("li",[t._v("Nginx为什么是多进程结构：多线程共用一个地址空间，易出现缓存失效，Nginx使用多进程单线程，不仅能提高并发率,而且进程之间是相互独立，互不干扰。")]),t._v(" "),a("li",[t._v("什么是"),a("code",[t._v("http")]),t._v("请求优雅的关闭：判断连接是否空闲，并关闭空闲的连接")]),t._v(" "),a("li",[t._v("重载:先启动新的进程平稳运行后再关闭旧的进程，此时新进程可以向老进程发送"),a("code",[t._v("hup")]),t._v("信号进行回滚。")])])]),t._v(" "),a("h2",{attrs:{id:"_2-3-http模块"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-http模块"}},[t._v("#")]),t._v(" 2.3 HTTP模块")]),t._v(" "),a("h2",{attrs:{id:"_2-4-反向代理与负载均衡"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-反向代理与负载均衡"}},[t._v("#")]),t._v(" 2.4 反向代理与负载均衡")]),t._v(" "),a("h2",{attrs:{id:"_2-5-配置文件详解"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-配置文件详解"}},[t._v("#")]),t._v(" 2.5 配置文件详解")]),t._v(" "),a("h3",{attrs:{id:"全局模块配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#全局模块配置"}},[t._v("#")]),t._v(" 全局模块配置")]),t._v(" "),a("div",{staticClass:"language-html extra-class"},[a("pre",{pre:!0,attrs:{class:"language-html"}},[a("code",[t._v("user administrator administrators;  # 配置用户或者组，默认为nobody nobody。\nworker_processes 2;  # 允许生成的worker进程数，默认为1 建议设置为cpu内核数\npid /nginx/pid/nginx.pid;   # pid进程运行文件存放地址\nrror_log log/error.log debug;  # 设置日志路径，级别。这个设置可以放入全局块，http块，server块，级别以此为：debug|info|notice|warn|error|crit|alert|emerg\n")])])]),a("h3",{attrs:{id:"events模块的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#events模块的配置"}},[t._v("#")]),t._v(" events模块的配置")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("accept_mutex")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置网路连接序列化，防止惊群现象发生，默认为on")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("multi_accept")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置一个进程是否同时接受多个网络连接，默认为off")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("use")]),t._v(" epoll"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 事件驱动模型，select|poll|kqueue|epoll|resig|/dev/poll|eventport")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_connections")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单个work的最大连接数，默认为512")]),t._v("\n")])])]),a("h3",{attrs:{id:"http模块的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#http模块的配置"}},[t._v("#")]),t._v(" http模块的配置")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v("       mime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("types")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 文件扩展名与文件类型映射表")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v("  application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("octet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认文件类型，默认为text/plain")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("charset")]),t._v(" utf"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认编码")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启access日志服务 ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("log_format")]),t._v(" myFormat "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'$remote_addr–$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 自定义日志要记录的参数")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $remote_addr 与 $http_x_forwarded_for 用以记录客户端的ip地址；")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $remote_user ：用来记录客户端用户名称；")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $time_local ： 用来记录访问时间与时区；")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $request ： 用来记录请求的url与http协议；")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $status ： 用来记录请求状态；成功是200；")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $body_bytes_s ent ：记录发送给客户端文件主体内容大小；")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $http_referer ：用来记录从那个页面链接访问过来的；")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# $http_user_agent ：记录客户端浏览器的相关信息；")]),t._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("access_log")]),t._v(" log"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("access"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("log myFormat"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置日志存放位置并使用myFormat格式记录日志")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sendfile")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许sendfile方式传输文件，默认为off，可以在http块，server块，location块。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sendfile_max_chunk")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("100")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 每个进程每次调用传输数量不能大于设定的值，默认为0，即不设上限。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keepalive_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接超时时间，默认为75s，可以在http，server，location块。")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip")]),t._v(" on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启文件压缩")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_min_length")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 压缩小于一字节以上的 ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("gzip_comp_level")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 压缩级别")]),t._v("\n    gzip_type text"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("plain application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("javascript"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 要压缩的格式")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("upstream")]),t._v(" mysvr "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  #负载均衡配置 ")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7878")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 默认轮训模式")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".3")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("7878")]),t._v("  weight"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  max_fails"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" fail_timeout"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# weight设置加权轮训 max_fails允许请求失败次数 fail_timeout允许请求失败的时间间隔")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".10")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3333")]),t._v(" down"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# down不参与负载均衡")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".10")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".121")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3333")]),t._v(" backup"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# backup热备(当上一个服务器宕机后运行)")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("ip_hash")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 让同一个客户端请求相同的服务")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_page")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 错误页")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keepalive_requests")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("120")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 单连接请求上限次数。")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4545")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听端口")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 监听地址       ")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("h3",{attrs:{id:"location模块的配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#location模块的配置"}},[t._v("#")]),t._v(" location模块的配置")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("~")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("^")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("+")]),t._v("$ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求的url过滤，正则匹配，= 严格匹配 ~区分大小写匹配 !~区分大小写不匹配 ~* 不区分大小写匹配 !~* 不区分大小写不匹配 ^~ 如果路由匹配，那么不进行正则匹配")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v(" path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# root从当前目录下查找，alias是从根目录查看赵 ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" vv"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("txt"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置默认页")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("mysvr"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求转向mysvr 定义的服务器列表")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("autoindex")]),t._v(" off"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启自动目录 开启后用户可以访问全部静态资源  ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[t._v("$limit_rate")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 限制访问速度1k/s")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_max_body_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许客户端请求的最大单文件字节数")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("client_body_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("128")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 缓冲区代理缓冲用户端请求的最大字节数")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_connect_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# nginx跟后端服务器连接超时时间(代理连接超时)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_send_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 后端服务器数据回传时间(代理发送超时)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_read_timeout")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("90")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 连接成功后，后端服务器响应时间(代理接收超时)")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffer_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设置代理服务器（nginx）保存用户头信息的缓冲区大小")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_buffers")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("32")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# proxy_buffers缓冲区，网页平均在32k以下的设置")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_busy_buffers_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 高负荷下缓冲大小（proxy_buffers*2）")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_temp_file_write_size")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("64")]),t._v("k"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 设定缓存文件夹大小，大于这个值，将从upstream服务器传")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("deny")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("127.0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".0")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拒绝的ip")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("allow")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("172.18")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".5")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v(".54")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 允许的ip       ")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("rewrite")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("oldindex "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v(" permanent"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("break")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 重定向 oldindex → index ")]),t._v("\n              \n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" \n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[t._v('拦截或转发请求时有无"/"的区别')]),t._v(" "),a("ul",[a("li",[t._v("拦截：")])]),t._v(" "),a("blockquote",[a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拦截所有api开头的")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 拦截所有api/开头的")]),t._v("\n")])])])]),t._v(" "),a("ul",[a("li",[t._v("转发请求：")])]),t._v(" "),a("blockquote",[a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("api "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jaqi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 相对路径 相当于被代理到 http://jaqi.api/api")]),t._v("\n   "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("proxy_pass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("jaqi"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("api"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 绝对路径 相当于被代理到 http://jaqi.api")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])])])]),t._v(" "),a("p",[t._v("案例:")]),t._v(" "),a("div",{staticClass:"language-nginx extra-class"},[a("pre",{pre:!0,attrs:{class:"language-nginx"}},[a("code",[t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#user  nobody;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_processes")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_log  logs/error.log;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_log  logs/error.log  notice;")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_log  logs/error.log  info;")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#pid        logs/nginx.pid;")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("events")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("worker_connections")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1024")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("http")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("include")]),t._v("       mime"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("types")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("default_type")]),t._v("  application"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("octet"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("stream"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#                  '$status $body_bytes_sent \"$http_referer\" '")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v('#                  \'"$http_user_agent" "$http_x_forwarded_for"\';')]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log  logs/access.log  main;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("sendfile")]),t._v("        on"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#tcp_nopush     on;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#keepalive_timeout  0;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("keepalive_timeout")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("65")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#gzip  on;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("listen")]),t._v("       "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("80")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("server_name")]),t._v("  localhost"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#charset koi8-r;")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#access_log  logs/host.access.log  main;")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" \n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("index")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("htm"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#error_page  404              /404.html;")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# redirect server error pages to the static page /50x.html")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("error_page")]),t._v("   "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("500")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("502")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("503")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("504")]),t._v("  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("location")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),t._v("x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("html "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("root")]),t._v("   html"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# proxy the PHP scripts to Apache listening on 127.0.0.1:80")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location ~ \\.php$ {")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    proxy_pass   http://127.0.0.1;")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location ~ \\.php$ {")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    root           html;")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    fastcgi_pass   127.0.0.1:9000;")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    fastcgi_index  index.php;")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    include        fastcgi_params;")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# deny access to .htaccess files, if Apache's document root")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# concurs with nginx's one")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#location ~ /\\.ht {")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    deny  all;")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# another virtual host using mix of IP-, name-, and port-based configuration")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#server {")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    listen       8000;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    listen       somename:8080;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    server_name  somename  alias  another.alias;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    location / {")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        root   html;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        index  index.html index.htm;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    }")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# HTTPS server")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#server {")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    listen       443 ssl;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    server_name  localhost;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    ssl_certificate      cert.pem;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    ssl_certificate_key  cert.key;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    ssl_session_cache    shared:SSL:1m;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    ssl_session_timeout  5m;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    ssl_ciphers  HIGH:!aNULL:!MD5;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    ssl_prefer_server_ciphers  on;")]),t._v("\n\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    location / {")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        root   html;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#        index  index.html index.htm;")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#    }")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#}")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n")])])])])}),[],!1,null,null,null);s.default=e.exports}}]);