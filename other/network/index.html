<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>3.1 Web协议 | jaqi.note</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/jaqi.note/logo.jpg">
    <script>
                var _hmt = _hmt || [];
                (function() {
                    var hm = document.createElement("script");
                    hm.src = "https://hm.baidu.com/hm.js?b7303024b1d1000570507a8af21071bd";
                    var s = document.getElementsByTagName("script")[0];
                    s.parentNode.insertBefore(hm, s);
                })();
           </script>
    <meta name="description" content="字典，是惟一把成功放在工作之前的地方！">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="preload" href="/jaqi.note/assets/css/0.styles.12fde6e5.css" as="style"><link rel="preload" href="/jaqi.note/assets/js/app.a8f46c6d.js" as="script"><link rel="preload" href="/jaqi.note/assets/js/2.244728d6.js" as="script"><link rel="preload" href="/jaqi.note/assets/js/77.e715e962.js" as="script"><link rel="prefetch" href="/jaqi.note/assets/js/10.a3d0cc58.js"><link rel="prefetch" href="/jaqi.note/assets/js/11.e51336c9.js"><link rel="prefetch" href="/jaqi.note/assets/js/12.2b2d4813.js"><link rel="prefetch" href="/jaqi.note/assets/js/13.221369e0.js"><link rel="prefetch" href="/jaqi.note/assets/js/14.eb9cf3af.js"><link rel="prefetch" href="/jaqi.note/assets/js/15.ad6b7f26.js"><link rel="prefetch" href="/jaqi.note/assets/js/16.ad1a8e83.js"><link rel="prefetch" href="/jaqi.note/assets/js/17.f8467963.js"><link rel="prefetch" href="/jaqi.note/assets/js/18.91cbda41.js"><link rel="prefetch" href="/jaqi.note/assets/js/19.1608df84.js"><link rel="prefetch" href="/jaqi.note/assets/js/20.1190128a.js"><link rel="prefetch" href="/jaqi.note/assets/js/21.2945f88f.js"><link rel="prefetch" href="/jaqi.note/assets/js/22.056953db.js"><link rel="prefetch" href="/jaqi.note/assets/js/23.b5d59bc1.js"><link rel="prefetch" href="/jaqi.note/assets/js/24.2c21d3a7.js"><link rel="prefetch" href="/jaqi.note/assets/js/25.6312812f.js"><link rel="prefetch" href="/jaqi.note/assets/js/26.82ec113c.js"><link rel="prefetch" href="/jaqi.note/assets/js/27.560f09bf.js"><link rel="prefetch" href="/jaqi.note/assets/js/28.67b96731.js"><link rel="prefetch" href="/jaqi.note/assets/js/29.7c8cbfa8.js"><link rel="prefetch" href="/jaqi.note/assets/js/3.ac7fa2ce.js"><link rel="prefetch" href="/jaqi.note/assets/js/30.2698e05b.js"><link rel="prefetch" href="/jaqi.note/assets/js/31.93b84d6e.js"><link rel="prefetch" href="/jaqi.note/assets/js/32.d9d0f81a.js"><link rel="prefetch" href="/jaqi.note/assets/js/33.dedb4302.js"><link rel="prefetch" href="/jaqi.note/assets/js/34.ffeea0c2.js"><link rel="prefetch" href="/jaqi.note/assets/js/35.d7cb5d3a.js"><link rel="prefetch" href="/jaqi.note/assets/js/36.602c739a.js"><link rel="prefetch" href="/jaqi.note/assets/js/37.ef428da6.js"><link rel="prefetch" href="/jaqi.note/assets/js/38.5dd8d150.js"><link rel="prefetch" href="/jaqi.note/assets/js/39.a0b7df6a.js"><link rel="prefetch" href="/jaqi.note/assets/js/4.4e656f32.js"><link rel="prefetch" href="/jaqi.note/assets/js/40.54d5162d.js"><link rel="prefetch" href="/jaqi.note/assets/js/41.20face75.js"><link rel="prefetch" href="/jaqi.note/assets/js/42.ca746304.js"><link rel="prefetch" href="/jaqi.note/assets/js/43.8a9dcb5b.js"><link rel="prefetch" href="/jaqi.note/assets/js/44.45ab42be.js"><link rel="prefetch" href="/jaqi.note/assets/js/45.76555fad.js"><link rel="prefetch" href="/jaqi.note/assets/js/46.47b4f55a.js"><link rel="prefetch" href="/jaqi.note/assets/js/47.8a44f3b0.js"><link rel="prefetch" href="/jaqi.note/assets/js/48.369b86bb.js"><link rel="prefetch" href="/jaqi.note/assets/js/49.9ae0f9ed.js"><link rel="prefetch" href="/jaqi.note/assets/js/5.ebe65fd8.js"><link rel="prefetch" href="/jaqi.note/assets/js/50.3add5b2a.js"><link rel="prefetch" href="/jaqi.note/assets/js/51.365fca19.js"><link rel="prefetch" href="/jaqi.note/assets/js/52.2f29e190.js"><link rel="prefetch" href="/jaqi.note/assets/js/53.7f2804c5.js"><link rel="prefetch" href="/jaqi.note/assets/js/54.c433774d.js"><link rel="prefetch" href="/jaqi.note/assets/js/55.8c703d74.js"><link rel="prefetch" href="/jaqi.note/assets/js/56.3dd8c5d1.js"><link rel="prefetch" href="/jaqi.note/assets/js/57.812c09be.js"><link rel="prefetch" href="/jaqi.note/assets/js/58.a6f4c6fb.js"><link rel="prefetch" href="/jaqi.note/assets/js/59.308369cc.js"><link rel="prefetch" href="/jaqi.note/assets/js/6.8e5bcc75.js"><link rel="prefetch" href="/jaqi.note/assets/js/60.cba25b4e.js"><link rel="prefetch" href="/jaqi.note/assets/js/61.538da168.js"><link rel="prefetch" href="/jaqi.note/assets/js/62.044d5759.js"><link rel="prefetch" href="/jaqi.note/assets/js/63.a9b077ef.js"><link rel="prefetch" href="/jaqi.note/assets/js/64.6a1adc86.js"><link rel="prefetch" href="/jaqi.note/assets/js/65.05e3fc84.js"><link rel="prefetch" href="/jaqi.note/assets/js/66.0fed1dee.js"><link rel="prefetch" href="/jaqi.note/assets/js/67.f07b5683.js"><link rel="prefetch" href="/jaqi.note/assets/js/68.3068e0a2.js"><link rel="prefetch" href="/jaqi.note/assets/js/69.c2b3f26d.js"><link rel="prefetch" href="/jaqi.note/assets/js/7.0da0bd62.js"><link rel="prefetch" href="/jaqi.note/assets/js/70.e1c4853e.js"><link rel="prefetch" href="/jaqi.note/assets/js/71.b28da8fc.js"><link rel="prefetch" href="/jaqi.note/assets/js/72.426f621e.js"><link rel="prefetch" href="/jaqi.note/assets/js/73.edcf4ba9.js"><link rel="prefetch" href="/jaqi.note/assets/js/74.e111b23a.js"><link rel="prefetch" href="/jaqi.note/assets/js/75.8630e7ea.js"><link rel="prefetch" href="/jaqi.note/assets/js/76.ecd68f89.js"><link rel="prefetch" href="/jaqi.note/assets/js/78.2cc330dd.js"><link rel="prefetch" href="/jaqi.note/assets/js/79.73b537aa.js"><link rel="prefetch" href="/jaqi.note/assets/js/8.7a309ab5.js"><link rel="prefetch" href="/jaqi.note/assets/js/80.a33858aa.js"><link rel="prefetch" href="/jaqi.note/assets/js/81.85f697a5.js"><link rel="prefetch" href="/jaqi.note/assets/js/82.48491c51.js"><link rel="prefetch" href="/jaqi.note/assets/js/83.0e2ac4fb.js"><link rel="prefetch" href="/jaqi.note/assets/js/9.772ca248.js">
    <link rel="stylesheet" href="/jaqi.note/assets/css/0.styles.12fde6e5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/jaqi.note/" class="home-link router-link-active"><!----> <span class="site-name">jaqi.note</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/jaqi.note/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发文档" class="dropdown-title"><span class="title">开发文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发文档" class="mobile-dropdown-title"><span class="title">开发文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jaqi.note/frontend/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/jaqi.note/other/" class="nav-link router-link-active">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="https://jaqi.gitee.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jaqi.page
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://blog.csdn.net/ljq547152849" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jaqi.csnd
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/jaqi.note/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="开发文档" class="dropdown-title"><span class="title">开发文档</span> <span class="arrow down"></span></button> <button type="button" aria-label="开发文档" class="mobile-dropdown-title"><span class="title">开发文档</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/jaqi.note/frontend/" class="nav-link">
  前端
</a></li><li class="dropdown-item"><!----> <a href="/jaqi.note/other/" class="nav-link router-link-active">
  其他
</a></li></ul></div></div><div class="nav-item"><a href="https://jaqi.gitee.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jaqi.page
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="https://blog.csdn.net/ljq547152849" target="_blank" rel="noopener noreferrer" class="nav-link external">
  jaqi.csnd
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><a href="/jaqi.note/other/" class="sidebar-heading clickable router-link-active open"><span>其它</span> <span class="arrow down"></span></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/jaqi.note/other/linux/" class="sidebar-link">第一章：Linux</a></li><li><a href="/jaqi.note/other/nginx/" class="sidebar-link">第二章：Nginx</a></li><li><a href="/jaqi.note/other/network/" aria-current="page" class="active sidebar-link">第三章：web协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#_3-1-web协议" class="sidebar-link">3.1 Web协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#网络协议" class="sidebar-link">网络协议</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#osi模型与tcp-ip模型" class="sidebar-link">OSI模型与TCP/IP模型</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#web构架的关键属性" class="sidebar-link">web构架的关键属性：</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#五种架构风格" class="sidebar-link">五种架构风格：</a></li></ul></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#_3-2-http-1-1协议" class="sidebar-link">3.2 HTTP/1.1协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#http协议" class="sidebar-link">http协议</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#https协议" class="sidebar-link">https协议</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#基于abnf语义定义的http消息格式" class="sidebar-link">基于ABNF语义定义的HTTP消息格式</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#浏览器发起http请求的过程" class="sidebar-link">浏览器发起http请求的过程</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#使用chrome的network面板分析http报文" class="sidebar-link">使用Chrome的Network面板分析HTTP报文</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#uri基本格式" class="sidebar-link">URI基本格式</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#http请求行" class="sidebar-link">HTTP请求行</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#http包体" class="sidebar-link">HTTP包体</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#http响应行" class="sidebar-link">HTTP响应行</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#响应与请求上下文" class="sidebar-link">响应与请求上下文</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#会话跟踪技术" class="sidebar-link">会话跟踪技术</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#同源策略与跨域访问" class="sidebar-link">同源策略与跨域访问</a></li></ul></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#_3-3-websocket协议" class="sidebar-link">3.3 WebSocket协议</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#_3-4-http-2协议" class="sidebar-link">3.4 HTTP/2协议</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#_3-5-tls-ssl协议" class="sidebar-link">3.5 TLS/SSL协议</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#_3-6-tcp协议" class="sidebar-link">3.6 TCP协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#特点-3" class="sidebar-link">特点</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#报文格式" class="sidebar-link">报文格式</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#连接创建与断开的过程" class="sidebar-link">连接创建与断开的过程</a></li></ul></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#_3-7-udp协议" class="sidebar-link">3.7 UDP协议</a></li><li class="sidebar-sub-header"><a href="/jaqi.note/other/network/#_3-8-ip协议" class="sidebar-link">3.8 IP协议</a></li></ul></li><li><a href="/jaqi.note/other/SEO/" class="sidebar-link">第四章：SEO</a></li><li><a href="/jaqi.note/other/git/" class="sidebar-link">第五章：Git</a></li><li><a href="/jaqi.note/other/FreeMarker/" class="sidebar-link">第六章：FreeMarker</a></li><li><section class="sidebar-group collapsable is-sub-group depth-1"><a href="/jaqi.note/other/node/introduction/" class="sidebar-heading clickable"><span>第七章：node.js</span> <span class="arrow right"></span></a> <!----></section></li><li><a href="/jaqi.note/other/database/" class="sidebar-link">第八章：数据库</a></li><li><a href="/jaqi.note/other/docker/" class="sidebar-link">第九章：Docker</a></li><li><a href="/jaqi.note/other/dataStructure&amp;algorithm/" class="sidebar-link">第十章：数据结构与算法</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h2 id="_3-1-web协议"><a href="#_3-1-web协议" class="header-anchor">#</a> 3.1 Web协议</h2> <h3 id="网络协议"><a href="#网络协议" class="header-anchor">#</a> 网络协议</h3> <table><thead><tr><th>分类</th> <th>协议</th></tr></thead> <tbody><tr><td>应用层</td> <td><code>DHCP</code> <code>HTTP</code> <code>HTTPS</code> <code>RTMP</code> <code>P2P</code> <code>DNS</code> <code>GTP</code> <code>RPC</code></td></tr> <tr><td>传输层</td> <td><code>UDP</code> <code>TCP</code></td></tr> <tr><td>网络层</td> <td><code>ICMP</code> <code>IP</code> <code>OSPF</code> <code>BGP</code> <code>IPSec</code> <code>GRE</code></td></tr> <tr><td>链路层</td> <td><code>ARP</code> <code>VLAN</code> <code>STP</code></td></tr> <tr><td>物理层</td> <td><code>网络跳线</code></td></tr></tbody></table> <h3 id="osi模型与tcp-ip模型"><a href="#osi模型与tcp-ip模型" class="header-anchor">#</a> OSI模型与TCP/IP模型</h3> <p><img src="/jaqi.note/OSI%E6%A8%A1%E5%9E%8B.png" alt="OSI模型"></p> <ol><li>应用层：负责解决业务问题</li> <li>表示层：负责把网络中的消息转换成应用层可以读取的消息</li> <li>会话层：负责建立会话、握手、维持连接、关闭</li> <li>传输层：负责解决进程与进程之间的通信，例如TCP保证报文的可达性和流量的控制</li> <li>网络层：负责解决广域网（Internet）中主机之间数据的传递</li> <li>数据链路层：负责局域网中根据MAC地址连接的相应的交换机/路由器进行报文的转发</li> <li>物理层：物理传输介质</li></ol> <p>分层模型的优点在于当前层只需要考虑与其相邻层的对接交互，即每一层只为其之上的层服务，并使用在其之下的层所提供的服务，而不需要考虑其相邻层之外的其他层做了什么。分层模型的缺点在于不同层之间数据交互需要耗费更多的时间，从而影响网络性能。</p> <h3 id="web构架的关键属性"><a href="#web构架的关键属性" class="header-anchor">#</a> web构架的关键属性：</h3> <ul><li>性能：影响高可用的关键因素</li> <li>可伸缩性：支持部署可以互相交互的大量组件</li> <li>简单性：易理解、易实现、易验证</li> <li>可见性：对两个组件间的交互进行监视或者仲裁的能力。如缓存、分层设计等</li> <li>可移植性：在不同的环境下运行的能力</li> <li>可靠性：出现部分故障时对整体的影响程度</li> <li>可修改性：对系统做出修改的难易程度，由可进化型、可定制性、可扩展性、可配置性、可重用性构成</li></ul> <h3 id="五种架构风格"><a href="#五种架构风格" class="header-anchor">#</a> 五种架构风格：</h3> <ul><li>数据流风格 Data-flow Styles</li></ul> <blockquote><p>优点：简单性、可进化性、可扩展性、可配置性、可重用性</p></blockquote> <ul><li>复制风格 Replication Styles</li></ul> <blockquote><p>优点：用户可察觉的性能、可伸缩性，网络效率、可靠性也可以得到提升</p></blockquote> <ul><li>分层风格 Hierarchical Styles</li></ul> <blockquote><p>优点：简单性、可进化性、可伸缩性</p></blockquote> <ul><li>移动代码风格 Mobile Code Styles</li></ul> <blockquote><p>优点：可移植性、可扩展性、网络效率</p></blockquote> <ul><li>点对点风格 Peer-to-Peer Styles</li></ul> <blockquote><p>优点：可进化性、可重用性、可扩展性、可配置性</p></blockquote> <h2 id="_3-2-http-1-1协议"><a href="#_3-2-http-1-1协议" class="header-anchor">#</a> 3.2 HTTP/1.1协议</h2> <h3 id="http协议"><a href="#http协议" class="header-anchor">#</a> http协议</h3> <p>一种无状态的，应用层的，以请求/应答方式运行的协议。建立在TCP协议之上，它可以使用可扩展的语义和自描述消息格式。与基于网络的超文本信息系统灵活互动。（RFC723 2014.6）</p> <h4 id="特点"><a href="#特点" class="header-anchor">#</a> 特点：</h4> <ul><li>传输协议实际是交给TCP协议来完成的</li> <li>无状态：并不会存储用户的信息；如果连接意外断开，整个会话就会丢失，重新连接之后一般需要从头开始</li> <li>请求/应答：一次请求对应一次响应</li> <li>可扩展：可以自定义扩展一些head字段等</li> <li>自描述： 消息体可以是音频视频、文本、图片等（Content-type）</li></ul> <h3 id="https协议"><a href="#https协议" class="header-anchor">#</a> https协议</h3> <p>由于HTTP天生“明文&quot;的特点,整个传输过程完全透明,任何人都能够在链路中截获、修改或者伪造请求/响应报文,数据不具有可信性。因此就诞生了为安全而生的HTTPS协议使用HTTPS时，所有的HTTP请求和响应在发送到网络之前，都要进行加密。</p> <p>https利用摘要算法、对称加密算法、非对称加密算法来完成的</p> <h3 id="基于abnf语义定义的http消息格式"><a href="#基于abnf语义定义的http消息格式" class="header-anchor">#</a> 基于ABNF语义定义的HTTP消息格式</h3> <h3 id="浏览器发起http请求的过程"><a href="#浏览器发起http请求的过程" class="header-anchor">#</a> 浏览器发起http请求的过程</h3> <p><img src="/jaqi.note/%E6%B5%8F%E8%A7%88%E5%99%A8%E5%8F%91%E8%B5%B7http%E8%AF%B7%E6%B1%82%E7%9A%84%E8%BF%87%E7%A8%8B.png" alt="浏览器发起http请求的过程"></p> <h3 id="使用chrome的network面板分析http报文"><a href="#使用chrome的network面板分析http报文" class="header-anchor">#</a> 使用Chrome的Network面板分析HTTP报文</h3> <h4 id="network面板构成-控制器、过滤器、概览、请求列表、概要"><a href="#network面板构成-控制器、过滤器、概览、请求列表、概要" class="header-anchor">#</a> Network面板构成：控制器、过滤器、概览、请求列表、概要</h4> <ol><li>控制器：</li></ol> <blockquote><p>抓包/停止抓包、清楚请求、跨页面加载请求（Preserve log）、屏幕截图（Capture screenshots）、重新执行XHR请求、停用浏览器缓存(Diaable cache)、手动清理缓存（cache）、手动清理缓存（cookie）、离线模式、模型网速、</p></blockquote> <ol start="2"><li>过滤器：</li></ol> <blockquote><ul><li>根据类型过滤：XHR、JS、Img、Media、Font、Doc、WS(WebSocket)、Mainifest、Other</li> <li>多类型过滤：Ctrl/Command+单击根据多个类型过滤</li> <li>按照时间过滤：</li> <li>过滤BASE64的请求：Data URLs</li> <li>根据属性过滤filter：domain（指定域）、has-response-header（指定响应头）、is:running（websocker）、is:from-cache(缓存)、larger-than（资源大小）、method（请求类型）、mime-type（MIME资源类型）、status-code（状态码）、set-cookoe-name/domain/value（具有set-cookoe标头的域/名称/值）、scheme(具有https保护的)、mixed-content（显示所有混合内容的资源）</li></ul></blockquote> <ol start="3"><li>概览：</li> <li>请求列表：</li></ol> <blockquote><p>请求列表排序：</p> <blockquote><ul><li>按照活动时间排序Waterfall：Start Time（第一个请求开始的）、Response Time（第一个开始下载的）、End Time（完成的第一个请求）、Total Duration（连接设置时间和请求、相应最快的请求）、Latency（等待最短响应时间的）</li> <li>请求发起方式Initiator:Parser（html解析器发起的）、Redirect（HTTP重定向发起的）、Script（JS脚步发起的）、Other（用户点击、地址栏输入地址等）</li></ul></blockquote></blockquote> <blockquote><p>预览请求详情:</p> <blockquote><ul><li>头部Headers:</li> <li>cookie</li> <li>预览响应正文Preview</li> <li>查看响应正文Response</li> <li>时间详情分布timing:Queueing（请求正在排队）、Stalled（请求被终止）、DNS Lookup（解析地址）、Proxy Negotiation（正在与代理服务器协商请求）、Requst sent（正在发送请求）、ServiceWorker Preparation（浏览器正在启动Service Worker ）、Request to ServiceWorker（浏览器正将请求发送到Service Worker） Waiting（浏览器正在等待响应的第一个字节）、Content Download（浏览器正在接收响应） Receiving Push（浏览器正在通过HTTP/2服务器推送接收此响应的数据）、 Reading Push（浏览器正在读取之前收到的本地数据）</li> <li>请求的上下游:shift键+鼠标悬停</li></ul></blockquote></blockquote> <blockquote><p>查看请求的上下游:shift+鼠标悬停，红色下游、绿色上游</p></blockquote> <ol start="5"><li>概要：请求总数，总数据量，DOM加载时间，总加载时间：</li></ol> <h3 id="uri基本格式"><a href="#uri基本格式" class="header-anchor">#</a> URI基本格式</h3> <p>URL统一资源定位符，URI统一资源标识符，URN统一资源名称。
URI的组成：scheme-user-informantion-host-port+query-fragment
为什么要进行URI编码：避免数据编码歧义。</p> <h3 id="http请求行"><a href="#http请求行" class="header-anchor">#</a> HTTP请求行</h3> <p>HTTP版本：0.9（只支持get方法）、1.0 （常用代理服务器例如nginx默认配置）1.1（1999年发布）、2.0(2015年发布)
HTTP常见方法：</p> <blockquote><p><code>GET</code>：主要的获取信息方法，幂等方法<br> <code>HEAD</code>：类似于GET，但服务器不发送body，用以获取HEAD元数据，幂等方法<br> <code>POST</code>：常用于表单，和新增资源<br> <code>PUT</code>：常用于更新资源，带条件时是幂等方法<br> <code>DELETE</code>：删除资源，幂等方法<br> <code>CONNECT</code>：建立tunnel隧道<br> <code>OPTIONS</code>：显示服务器对访问资源支持的方法，幂等方法<br> <code>TRACE</code>：回显服务器收到的请求，用于定位问题。有延期风险。（nginx不支持）</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>幂等方法：调用一次和调用多次结果一致。</p></div> <h3 id="http包体"><a href="#http包体" class="header-anchor">#</a> HTTP包体</h3> <h3 id="http响应行"><a href="#http响应行" class="header-anchor">#</a> HTTP响应行</h3> <p>HTTP响应码：</p> <blockquote><p>* 1xx：请求已收到，需要进一步处理</p> <blockquote><p>100：上传大文件前使用
 101：协议升级使用
 102：用于WebDAV请求、服务器已收到，需要很长一段时间完成。</p></blockquote></blockquote> <blockquote><p>* 2xx：成功处理的请求</p> <blockquote><p>200：成功返回响应
 201：有新资源在服务器端被创建
 202：服务器接收并开始处理请求，单请求未处理完成。
 203：告诉客户端代理服务器修改了原服务器的数据。
 204：成功的执行了请求，但不响应包体。暗示客户端无需更新视图。
 205：成功的执行了请求，但不响应包体。提示客户端需要更新视图。
 206：range协议时返回部分响应内容时的响应码。
 207：WebDev协议中以XML返回多个资源的状态。
 208：WebDev协议中父集合的响应码</p></blockquote></blockquote> <blockquote><p>* 3xx：重定向,次数不超过5次</p> <blockquote><p>300：告诉客户端自行选择访问方式
 301：永久重定向
 302：临时重定向
 303：重定向到其他资源
 304：缓存过期
 307：
 308：</p></blockquote></blockquote> <blockquote><p>* 4xx：客户端出现错误</p> <blockquote><p>400：服务端认为客户端出现了错误，且不属于以下错误类型。。
 401：用户认证信息不正确或缺失。
 407：对需要经由代理的请求，认证信息未通过代理服务器。
 403：没有权限
 404：没有找到对应资源
 410：没有找到对应资源，且知道资源永久性的找不到。
 405：服务器不支持改请求方法。
 406：对客户端指定的资源表述不存在。
 408：服务器接收请求超时。
 409：资源冲突。
 411：请求中有包体，未携带Content-length头部，且不属于chunk类请求。
 412：条件类请求，不满足时
 413：包体超出最大长度
 414：请求的URI超长
 415：上传的文件类型不被服务器支持
 416：无法提供range请求中指定的那段包体
 417：对Expect请求头部期待的情况无法满足时的相应码
 421：服务器认为请求不应该发给它
 426：服务器拒绝基于http协议提供服务
 428：用户请求中缺失了条件类头部
 429：发送请求速率过快
 431：请求的header头部大小超过限制
 451：由于法律渊源资源不可以访问</p></blockquote></blockquote> <blockquote><p>* 5xx：服务端出现错误</p> <blockquote><p>500：服务器内部出现错误，且不属于以下错误类型。
 501：不支持实现请求所需要的功能。
 502：代理服务器无法获取到合法请求。
 503：服务器资源尚未准备好处理当前请求。
 504：代理服务器无法及时的从上游获取相应。
 505：请求使用的http协议版本不支持。
 507：服务器没有足够的空间处理请求。
 508：访问资源时检测到循环
 511：代理服务器发现客户端需要进行身份验证才能获得网络访问权限。</p></blockquote></blockquote> <h3 id="响应与请求上下文"><a href="#响应与请求上下文" class="header-anchor">#</a> 响应与请求上下文</h3> <p><code>User-Agent</code>:客户端类型信息<br> <code>Referer</code>:浏览器告诉服务器该网页是从哪个页面链接过来的（常用于处理防盗链、统计分析、缓冲优化等）<br> <code>Form</code>:用于网络爬虫，告诉服务器爬虫信息<br> <code>Server</code>:告诉客户端，服务器上用的软件信息<br> <code>Allow</code>:告诉客户端，服务器支持的请求方法<br> <code>Transfer-Encoding</code>:包体的传输方式<br> <code>Connection</code>:约定服务端返回后是否关闭TCP连接（用于多次HTTP之间重用同一个TCP连接）
<code>Content-Type</code>:定义网络文件的类型和网页的编码</p> <h4 id="内容协商"><a href="#内容协商" class="header-anchor">#</a> 内容协商：</h4> <ul><li>Proactive（主动内容协商）</li> <li>Reactive（响应式内容协商）<br> <code>Accept</code><br> <code>Accept-Encoding</code>:压缩算法<br> <code>Accept-Language</code>:语言、质量（质量因子q）</li></ul> <h4 id="ranges规范-用于断点续传、多线程下载"><a href="#ranges规范-用于断点续传、多线程下载" class="header-anchor">#</a> Ranges规范（用于断点续传、多线程下载）：</h4> <p><code>Accept-Ranges</code>:设置Range头信息
<code>Content-Ranges</code></p> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>利用http重定向https可以跳过防盗链</p></div> <h3 id="会话跟踪技术"><a href="#会话跟踪技术" class="header-anchor">#</a> 会话跟踪技术</h3> <h4 id="会话跟踪技术-2"><a href="#会话跟踪技术-2" class="header-anchor">#</a> 会话跟踪技术：</h4> <p>会话：从打开页面到关闭页面<br>
跟踪：客户端与服务器多次请求数据，时进行数据共享</p> <p>目的是解决http协议无状态的问题</p> <h4 id="cookie"><a href="#cookie" class="header-anchor">#</a> <code>Cookie</code></h4> <p>通过检查客服端上的“通行证”来确认客户身份。</p> <p><code>Cookie</code>的签发流程：客户端首次请求服务器，服务端返回一个<code>Cookie</code>通行证，当客户端携带<code>Cookie</code>通行证并再一次发送请求时，服务端检查<code>Cookie</code>来确认客户身份。</p> <p><code>set-cookie</code>
set-cookie:value [;expires=date][;domain=domain][;path=path][;secure][;HttpOnly]</p> <blockquote><p>expires过期时间、domain域名、path路径、secure必须是https、HttpOnly不允许修改</p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code>  document<span class="token punctuation">.</span>cookie<span class="token operator">=</span><span class="token string">&quot;username=John Doe; expires=Thu, 18 Dec 2043 12:00:00 GMT; path=/admin secure HttpOnly&quot;</span><span class="token punctuation">;</span>
  response<span class="token punctuation">.</span><span class="token function">addHeader</span><span class="token punctuation">(</span><span class="token string">&quot;Set-Cookie&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;timeout=30; Path=/admin; secure HttpOnly&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="session"><a href="#session" class="header-anchor">#</a> <code>Session</code></h4> <p>通过检查服务端上的“客户表”来确认客户身份。
<code>Session</code>的签发流程：客户端首次请求服务器，服务端会生成一个客户记录，当客户端再一次发送请求时，服务端检查当前客户是否在客户表中，来确认客户身份。</p> <h4 id="token"><a href="#token" class="header-anchor">#</a> <code>Token</code></h4> <p><code>Token</code>是无状态的，是服务端生成的一串字符串，以作客户端进行请求的一个令牌，当第一次登录后，服务器生成一个<code>Token</code>并返回给客户端，以后客户端只需带上这个<code>Token</code>前来请求数据即可，无需再次带上用户名和密码。</p> <div class="custom-block tip"><p class="custom-block-title">`Cookie`和`Session`的区别</p> <ol><li>存储位置：<code>Cookie</code>存在客户端，<code>Session</code>存在服务端。</li> <li>存储容量：<code>Cookie</code>最大4KB且一个域名最多20个，<code>Session</code>没有上限。</li> <li>存储方式：<code>Cookie</code>中只能保管ASCII字符串，并需要通过编码方式存储为Unicode字符或者二进制数据。<code>Session</code>能存储任何类型的数据。</li> <li>隐私策略：<code>Cookie</code>对客户端是可见的，因此不安全。</li> <li>效期：<code>Cookie</code>可以长期有效，<code>Session</code>关闭窗口即失效。</li> <li>浏览器：<code>Cookie</code>依赖浏览器的支持。</li> <li>跨域：<code>Cookie</code>支持跨域名访问（但是不能跨域操作），<code>Session</code>不支持跨域名</li></ol></div> <div class="custom-block tip"><p class="custom-block-title">`Session`和`Token`的区别</p> <ol><li><code>Session</code>需要存储每个客户端<code>cookie</code>里的数据、<code>Token</code>只需要存一段加密代码即可</li></ol></div> <h3 id="同源策略与跨域访问"><a href="#同源策略与跨域访问" class="header-anchor">#</a> 同源策略与跨域访问</h3> <p>限制不同源的对象或js脚本互相影响</p> <p>同源：<code>“协议+子域名+主域名+端口号+请求资源地址”</code>完全一致</p> <p><code>CORS</code>跨域资源共享</p> <ul><li>简单请求</li></ul> <ol><li>请求方法：<code>HEAD</code>、<code>GET</code>、<code>POST</code>、</li> <li>HTTP的头信息不超出以下几种字段：<code>Accept</code>、<code>Accept-Language</code>、<code>Content-Language</code>、<code>Last-Event-ID</code>、
<code>Content-Type（application/x-www-form-urlencoded、multipart/form-data、text/plain）</code></li></ol> <ul><li>非简单请求
凡是不同时满足上面简单请求，就属于非简单请求</li></ul> <h4 id="简单请求跨域访问"><a href="#简单请求跨域访问" class="header-anchor">#</a> 简单请求跨域访问：</h4> <p>设置Origin字段用来说明，本次请求来自哪个源（协议 + 域名 + 端口）
如果Origin指定的域名在许可范围内，服务器会返回一下信息:</p> <blockquote><p><code>Access-Control-Allow-Origin</code>:返回请求时Origin字段的值，或者是*，表示接受任意域名的请求
<code>Access-Control-Allow-Credentials</code>: 返回是否允许发送Cookie
<code>Access-Control-Expose-Headers</code>: 返回</p></blockquote> <h4 id="非简单请求跨域访问"><a href="#非简单请求跨域访问" class="header-anchor">#</a> 非简单请求跨域访问：</h4> <ul><li>预检请求</li> <li>预检请求的回应</li></ul> <h2 id="_3-3-websocket协议"><a href="#_3-3-websocket协议" class="header-anchor">#</a> 3.3 WebSocket协议</h2> <p>HTTP协议有只能由客户端发起，如果想获取连续的状态变化，只能通过轮询的方式（轮询的效率低，非常浪费资源）</p> <p>WebSocket 协议在2008年诞生，2011年成为国际标准。所有浏览器都已经支持了
它的最大特点就是，服务器可以主动向客户端推送信息，客户端也可以主动向服务器发送信息，是真正的双向平等对话，属于服务器推送技术的一种</p> <h4 id="特点-2"><a href="#特点-2" class="header-anchor">#</a> 特点</h4> <ol><li>建立在 TCP 协议之上，服务器端的实现比较容易</li> <li>与 HTTP 协议有着良好的兼容性。默认端口也是80和443，并且握手阶段采用 HTTP 协议，因此握手时不容易屏蔽，能通过各种 HTTP 代理服务器</li> <li>数据格式比较轻量，性能开销小，通信高效</li> <li>可以发送文本，也可以发送二进制数据</li> <li>没有同源限制，客户端可以与任意服务器通信</li> <li>协议标识符是ws（如果加密，则为wss），服务器网址就是 URL</li></ol> <h4 id="方法与属性"><a href="#方法与属性" class="header-anchor">#</a> 方法与属性</h4> <p><code>readyState</code>：返回webSocket状态<br> <code>onopen</code>连接成功后的回调<br> <code>send</code>向服务器发送数据<br> <code>onmessage</code>收到数据后的回调<br> <code>onclose</code>连接关闭后的回调<br> <code>bufferedAmount</code>返回为啥送的字节，用来判断是否发送结束<br> <code>onerror</code>报错回调</p> <h4 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h4> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> ws <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">WebSocket</span><span class="token punctuation">(</span><span class="token string">&quot;wss://echo.websocket.org&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 连接成功后的回调函数</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onopen</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&quot;Hello WebSockets!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 收到服务器数据后的回调函数</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 连接关闭后的回调函数</span>
ws<span class="token punctuation">.</span><span class="token function-variable function">onclose</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">evt</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Connection closed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span> 
</code></pre></div><ul><li>批量监听</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">'open'</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  ws<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">'Hello Server!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;message&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> data <span class="token operator">=</span> event<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
  <span class="token comment">// 处理数据</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

ws<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;close&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> code <span class="token operator">=</span> event<span class="token punctuation">.</span>code<span class="token punctuation">;</span>
  <span class="token keyword">var</span> reason <span class="token operator">=</span> event<span class="token punctuation">.</span>reason<span class="token punctuation">;</span>
  <span class="token keyword">var</span> wasClean <span class="token operator">=</span> event<span class="token punctuation">.</span>wasClean<span class="token punctuation">;</span>
  <span class="token comment">// handle close event</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="websocket的几种状态"><a href="#websocket的几种状态" class="header-anchor">#</a> WebSocket的几种状态</h4> <ol><li><code>CONNECTING</code>：0，表示正在连接</li> <li><code>OPEN</code>：1，表示连接成功，可以通信了</li> <li><code>CLOSING</code>：2，表示连接正在关闭</li> <li><code>CLOSED</code>：3，表示连接已经关闭，或者打开连接失败</li></ol> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">switch</span> <span class="token punctuation">(</span>ws<span class="token punctuation">.</span>readyState<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CONNECTING</span><span class="token operator">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">OPEN</span><span class="token operator">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CLOSING</span><span class="token operator">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">case</span> WebSocket<span class="token punctuation">.</span><span class="token constant">CLOSED</span><span class="token operator">:</span>
    <span class="token comment">// do something</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
  <span class="token keyword">default</span><span class="token operator">:</span>
    <span class="token comment">// this never happens</span>
    <span class="token keyword">break</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_3-4-http-2协议"><a href="#_3-4-http-2协议" class="header-anchor">#</a> 3.4 HTTP/2协议</h2> <p>HRRP2(RFC7540,2015.5)
未改变HTTP/1.1的语义
基于TCP，仅修改应用层
在应用层上修改，基于并充分挖掘TCP协议性能
客户端向server发送request的基本模型不变</p> <ul><li>特性：</li></ul> <blockquote><p>传输数据量大幅减少</p> <blockquote><p>以二进制方式传输<br>
表头压缩</p></blockquote></blockquote> <blockquote><p>多路复用及相关功能</p> <blockquote><p>消息优先级</p></blockquote></blockquote> <blockquote><p>服务器消息推送</p> <blockquote><p>并行推送</p></blockquote></blockquote> <ul><li>核心概念：</li></ul> <blockquote><blockquote><p>连接Connection：一个TCP连接包含多个Stream<br>
数据流(Stream)：一个双向通讯数据流，包含一条或多条Message<br>
消息(Message)：对应THHP/1中的请求或响应，包含一条或多条Frame<br>
数据帧(Frame)：最小单位，以二进制压缩格式存放HTTP/1中的内容</p></blockquote></blockquote> <div class="custom-block tip"><p class="custom-block-title">帧(Frame)、消息(Message)、流(Stream)的关系</p></div> <h2 id="_3-5-tls-ssl协议"><a href="#_3-5-tls-ssl协议" class="header-anchor">#</a> 3.5 TLS/SSL协议</h2> <h2 id="_3-6-tcp协议"><a href="#_3-6-tcp协议" class="header-anchor">#</a> 3.6 TCP协议</h2> <p>传输控制协议（TCP，Transmission Control Protocol）是一种面向连接的、可靠的、基于字节流的传输层通信协议</p> <h3 id="特点-3"><a href="#特点-3" class="header-anchor">#</a> 特点</h3> <ul><li>基于链接的：传输数据之前需要建立链接</li> <li>全双工：双向传输（请求响应）</li> <li>字节流：不限制请求大小，打包成报文段，保证有序接受，重复报文自动丢弃</li> <li>流量缓存：解决双方处理能力的不匹配</li> <li>可靠的传输服务：保证可达，丢包时通过重发机制实现可靠</li> <li>拥塞控制：防止网络出现恶性拥塞</li></ul> <h3 id="报文格式"><a href="#报文格式" class="header-anchor">#</a> 报文格式</h3> <p><img src="/jaqi.note/tcp%E6%8A%A5%E6%96%87.png" alt="tcp报文"></p> <ol><li>端口号：用来标识同一台计算机的不同的应用进程</li></ol> <blockquote><ul><li>源端口：源端口和IP地址的作用是标识报文的返回地址</li></ul></blockquote> <blockquote><ul><li>目的端口：端口指明接收方计算机上的应用程序接口</li></ul></blockquote> <ol start="2"><li><p>序号：是TCP可靠传输的关键部分。序号是本报文段发送的数据组的第一个字节的序号。在TCP传送的流中，每一个字节一个序号。如：（一个报文段的序号为300，此报文段数据部分共有100字节，则下一个报文段的序号为400。所以序号确保了TCP传输的有序性）</p></li> <li><p>确认号，即ACK，指明下一个期待收到的字节序号，表明该序号之前的所有数据已经正确无误的收到。确认号只有当ACK标志为1时才有效。如：（建立连接时，SYN报文的ACK标志位为0）</p></li> <li><p>数据偏移／首部长度：4bits。由于首部可能含有可选项内容，因此TCP报头的长度是不确定的，报头不包含任何任选字段则长度为20字节，4位首部长度字段所能表示的最大值为1111，转化为10进制为15，15*32/8 = 60，故报头最大长度为60字节。首部长度也叫数据偏移，是因为首部长度实际上指示了数据区在报文段中的起始偏移值</p></li> <li><p>保留：为将来定义新的用途保留，现在一般置0</p></li> <li><p>控制位：URG  ACK  PSH  RST  SYN  FIN，共6个，每一个标志位表示一个控制功能</p></li></ol> <blockquote><ul><li>URG：紧急指针标志，为1时表示紧急指针有效，为0则忽略紧急指针</li> <li>ACK：确认序号标志，为1时表示确认号有效，为0表示报文中不含确认信息，忽略确认号字段</li> <li>PSH：push标志，为1表示是带有push标志的数据，指示接收方在接收到该报文段以后，应尽快将这个报文段交给应用程序，而不是在缓冲区排队</li> <li>RST：重置连接标志，用于重置由于主机崩溃或其他原因而出现错误的连接。或者用于拒绝非法的报文段和拒绝连接请求</li> <li>SYN：同步序号，用于建立连接过程，在连接请求中，SYN=1和ACK=0表示该数据段没有使用捎带的确认域，而连接应答捎带一个确认，即SYN=1和ACK=1</li> <li>FIN：finish标志，用于释放连接，为1时表示发送方已经没有数据发送了，即关闭本方数据流</li></ul></blockquote> <ol start="7"><li><p>窗口：滑动窗口大小，用来告知发送端接受端的缓存大小，以此控制发送端发送数据的速率，从而达到流量控制。窗口大小时一个16bit字段，因而窗口大小最大为65535</p></li> <li><p>校验和：奇偶校验，此校验和是对整个的 TCP 报文段，包括 TCP 头部和 TCP 数据，以 16 位字进行计算所得。由发送端计算和存储，并由接收端进行验证</p></li> <li><p>紧急指针：只有当 URG 标志置 1 时紧急指针才有效。紧急指针是一个正的偏移量，和顺序号字段中的值相加表示紧急数据最后一个字节的序号。 TCP 的紧急方式是发送端向另一端发送紧急数据的一种方式</p></li> <li><p>选项和填充：最常见的可选字段是最长报文大小，又称为MSS（Maximum Segment Size），每个连接方通常都在通信的第一个报文段（为建立连接而设置SYN标志为1的那个段）中指明这个选项，它表示本端所能接受的最大报文段的长度。选项长度不一定是32位的整数倍，所以要加填充位，即在这个字段中加入额外的零，以保证TCP头是32的整数倍</p></li> <li><p>数据部分： TCP 报文段中的数据部分是可选的。在一个连接建立和一个连接终止时，双方交换的报文段仅有 TCP 首部。如果一方没有数据要发送，也使用没有任何数据的首部来确认收到的数据。在处理超时的许多情况中，也会发送不带任何数据的报文段</p></li></ol> <h3 id="连接创建与断开的过程"><a href="#连接创建与断开的过程" class="header-anchor">#</a> 连接创建与断开的过程</h3> <p><img src="/jaqi.note/TCP%E4%B8%89%E6%8F%A1%E5%9B%9B%E6%8C%A5.png" alt="TCP三握四挥"></p> <h4 id="创建链接"><a href="#创建链接" class="header-anchor">#</a> 创建链接：</h4> <ol><li>第一次握手：客户端给服务端发一个<code>SYN</code>报文，并指明客户端的初始化序列号<code>ISN</code>。此时客户端处于<code>SYN_SENT</code>状态</li></ol> <blockquote><p>首部的同步位SYN=1，初始序号seq=x，SYN=1的报文段不能携带数据，但要消耗掉一个序号</p></blockquote> <ol start="2"><li>第二次握手：服务器收到客户端的<code>SYN</code>报文之后，会以自己的<code>SYN</code>报文作为应答，并且也是指定了自己的初始化序列号<code>ISN(s)</code>。同时会把客户端的<code>ISN + 1</code>作为ACK的值，表示自己已经收到了客户端的<code>SYN</code>，此时服务器处于<code>SYN_RCVD</code>的状态。</li></ol> <blockquote><p>在确认报文段中SYN=1，ACK=1，确认号ack=x+1，初始序号seq=y。</p></blockquote> <ol start="3"><li>第三次握手：客户端收到<code>SYN</code>报文之后，会发送一个<code>ACK</code>报文，当然，也是一样把服务器的<code>ISN + 1</code>作为<code>ACK</code>的值，表示已经收到了服务端的<code>SYN</code>报文，此时客户端处于<code>ESTABLISHED</code>状态。服务器收到<code>ACK</code>报文之后，也处于<code>ESTABLISHED</code>状态，此时，双方已建立起了连接。</li></ol> <blockquote><p>确认报文段ACK=1，确认号ack=y+1，序号seq=x+1（初始为seq=x，第二个报文段所以要+1），ACK报文段可以携带数据，不携带数据则不消耗序号</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ol><li>为什么需要三次握手，两次不行吗？</li></ol> <blockquote><p>如果是用两次握手,会出现因为请求滞留导致，客户端与服务端状态不一致。</p></blockquote> <ol start="2"><li>什么是半连接队列？</li></ol> <blockquote><p>服务器第一次收到客户端的<code>SYN</code>之后，就会处于<code>SYN_RCVD</code>状态，此时双方还没有完全建立其连接，服务器会把此种状态下请求连接放在一个队列里，我们把这种队列称之为半连接队列</p></blockquote> <ol start="3"><li>ISN(Initial Sequence Number)是固定的吗?</li></ol> <blockquote><p>当一端为建立连接而发送它的<code>SYN</code>时，它为连接选择一个初始序号。<code>ISN</code>随时间而变化，因此每个连接都将具有不同的<code>ISN</code>。<code>ISN</code>可以看作是一个32比特的计数器，每4ms加1。这样选择序号的目的在于防止在网络中被延迟的分组在以后又被传送，而导致某个连接的一方对它做错误的解释</p></blockquote> <ol start="4"><li>三次握手过程中可以携带数据吗？</li></ol> <blockquote><p>第三次握手的时候，是可以携带数据的。但是，第一次、第二次握手不可以携带数据</p></blockquote> <ol start="5"><li>SYN攻击是什么？</li></ol> <blockquote><p>服务器端的资源分配是在二次握手时分配的，而客户端的资源是在完成三次握手时分配的，所以服务器容易受到SYN洪泛攻击。<code>SYN</code>攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送<code>SYN</code>包，Server则回复确认包，并等待Client确认，由于源地址不存在，因此Server需要不断重发直至超时，这些伪造的<code>SYN</code>包将长时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络拥塞甚至系统瘫痪。<code>SYN</code>攻击是一种典型的DoS/DDoS 攻击</p></blockquote></div> <h4 id="关闭链接"><a href="#关闭链接" class="header-anchor">#</a> 关闭链接：</h4> <ol><li>第一次挥手：客户端发送一个<code>FIN</code>报文，报文中会指定一个序列号。此时客户端处于<code>FIN_WAIT1</code>状态</li></ol> <blockquote><p>即发出连接释放报文段（FIN=1，序号seq=u），并停止再发送数据，主动关闭TCP连接，进入FIN_WAIT1（终止等待1）状态，等待服务端的确认</p></blockquote> <ol start="2"><li>第二次挥手：服务端收到<code>FIN</code>之后，会发送<code>ACK</code>报文，且把客户端的序列号值<code>u + 1</code>作为<code>ACK</code>报文的序列号值，表明已经收到客户端的报文了，此时服务端处于<code>CLOSE_WAIT</code>状态</li></ol> <blockquote><p>即服务端收到连接释放报文段后即发出确认报文段（ACK=1，确认号ack=u+1，序号seq=v），服务端进入CLOSE_WAIT（关闭等待）状态，此时的TCP处于半关闭状态，客户端到服务端的连接释放。客户端收到服务端的确认后，进入FIN_WAIT2（终止等待2）状态，等待服务端发出的连接释放报文段</p></blockquote> <ol start="3"><li>第三次挥手：如果服务端也想断开连接了，和客户端的第一次挥手一样，发给<code>FIN</code>报文，且指定一个序列号。此时服务端处于<code>LAST_ACK</code>的状态</li></ol> <blockquote><p>即服务端没有要向客户端发出的数据，服务端发出连接释放报文段（FIN=1，ACK=1，序号seq=w，确认号ack=u+1），服务端进入LAST_ACK（最后确认）状态，等待客户端的确认</p></blockquote> <ol start="4"><li>第四次挥手：客户端收到<code>FIN</code>之后，一样发送一个<code>ACK</code>报文作为应答，且把服务端的序列号值<code>u + 1</code>作为自己<code>ACK</code>报文的序列号值，此时客户端处于<code>TIME_WAIT</code>状态。需要过一阵子以确保服务端收到自己的<code>ACK</code>报文之后才会进入<code>CLOSED</code>状态，服务端收到<code>ACK</code>报文之后，就处于关闭连接了，处于<code>CLOSED</code>状态。</li></ol> <blockquote><p>即客户端收到服务端的连接释放报文段后，对此发出确认报文段（ACK=1，seq=u+1，ack=w+1），客户端进入TIME_WAIT（时间等待）状态。此时TCP未释放掉，需要经过时间等待计时器设置的时间2MSL后，客户端才进入CLOSED状态</p></blockquote> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <ol><li>挥手为什么需要四次？</li></ol> <blockquote><p>当服务端收到<code>FIN</code>报文时，很可能还有数据未发完，所以不能立即关闭连接，只能先回复一个报文，告诉客户端,我收到了<code>FIN</code></p></blockquote> <ol start="2"><li>MSL、等待2MSL的意义？</li></ol> <blockquote><p>报文段最大生存时间MSL（Maximum Segment Lifetime）
保证客户端发送的最后一个ACK报文段能够到达服务端、防止“已失效的连接请求报文段”出现在本连接中</p></blockquote> <ol start="3"><li>ISN(Initial Sequence Number)是固定的吗?</li></ol> <blockquote><p>当一端为建立连接而发送它的SYN时，它为连接选择一个初始序号。ISN随时间而变化，因此每个连接都将具有不同的ISN。ISN可以看作是一个32比特的计数器，每4ms加1 。这样选择序号的目的在于防止在网络中被延迟的分组在以后又被传送，而导致某个连接的一方对它做错误的解释</p></blockquote> <ol start="4"><li>三次握手过程中可以携带数据吗？</li></ol> <blockquote><p>第三次握手的时候，是可以携带数据的。但是，第一次、第二次握手不可以携带数据</p></blockquote> <ol start="5"><li>SYN攻击是什么？</li></ol> <blockquote><p>服务器端的资源分配是在二次握手时分配的，而客户端的资源是在完成三次握手时分配的，所以服务器容易受到SYN洪泛攻击。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server则回复确认包，并等待Client确认，由于源地址不存在，因此Server需要不断重发直至超时，这些伪造的SYN包将长时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络拥塞甚至系统瘫痪。SYN 攻击是一种典型的 DoS/DDoS 攻击</p></blockquote> <ol start="5"><li>SYN攻击是什么？</li></ol> <blockquote><p>服务器端的资源分配是在二次握手时分配的，而客户端的资源是在完成三次握手时分配的，所以服务器容易受到SYN洪泛攻击。SYN攻击就是Client在短时间内伪造大量不存在的IP地址，并向Server不断地发送SYN包，Server则回复确认包，并等待Client确认，由于源地址不存在，因此Server需要不断重发直至超时，这些伪造的SYN包将长时间占用未连接队列，导致正常的SYN请求因为队列满而被丢弃，从而引起网络拥塞甚至系统瘫痪。SYN 攻击是一种典型的 DoS/DDoS 攻击</p></blockquote></div> <h2 id="_3-7-udp协议"><a href="#_3-7-udp协议" class="header-anchor">#</a> 3.7 UDP协议</h2> <p>用户数据报协议（UDP，User Data Protocol）是一种非面向连接的、不可靠的传输层通信协议</p> <h4 id="特点-4"><a href="#特点-4" class="header-anchor">#</a> 特点：</h4> <ul><li>非链接协议：传输数据之前不需要建立链接</li> <li>不可靠的传输服务</li> <li>不提供拥塞控制和流量控制机制</li></ul> <h2 id="_3-8-ip协议"><a href="#_3-8-ip协议" class="header-anchor">#</a> 3.8 IP协议</h2> <div class="custom-block tip"><p class="custom-block-title">TIP</p> <p>抓包工具：Wireshark、Fiddler、Charles、Proxyman</p></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/jaqi.note/other/nginx/" class="prev">
        第二章：Nginx
      </a></span> <span class="next"><a href="/jaqi.note/other/SEO/">
        第四章：SEO
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/jaqi.note/assets/js/app.a8f46c6d.js" defer></script><script src="/jaqi.note/assets/js/2.244728d6.js" defer></script><script src="/jaqi.note/assets/js/77.e715e962.js" defer></script>
  </body>
</html>
